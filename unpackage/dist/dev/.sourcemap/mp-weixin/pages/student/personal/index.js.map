{"version":3,"file":"index.js","sources":["pages/student/personal/index.vue","../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc3R1ZGVudC9wZXJzb25hbC9pbmRleC52dWU"],"sourcesContent":["<template>\n  <view class=\"personal-container\">\n    <!-- 骨架屏 -->\n    <skeleton v-if=\"isLoading\" :is-loading=\"true\" :show-avatar=\"true\" :show-title=\"true\" :show-content=\"true\"></skeleton>\n    \n    <!-- 用户信息区域 -->\n    <view v-else class=\"user-info-section\">\n      <view class=\"user-avatar\" @tap=\"chooseAvatar\">\n        <lazy-image :src=\"userInfo.avatar || '/static/student/default-avatar.png'\" mode=\"aspectFill\"></lazy-image>\n        <view class=\"upload-icon\">\n          <uni-icons type=\"camera\" size=\"16\" color=\"#fff\"></uni-icons>\n        </view>\n      </view>\n      <view class=\"user-info\">\n        <text class=\"user-name\">{{ userInfo.nickname || '未设置昵称' }}</text>\n        <text class=\"user-email\">{{ userInfo.email || '未绑定邮箱' }}</text>\n      </view>\n      <uni-icons type=\"arrowright\" size=\"20\" color=\"#fff\" @tap=\"editPersonalInfo\"></uni-icons>\n    </view>\n\n    <!-- 功能菜单区域 -->\n    <view class=\"menu-section\">\n      <!-- 我的社团 -->\n      <view class=\"menu-item\" @tap=\"goToMyClubs\">\n        <view class=\"menu-icon\">\n          <uni-icons type=\"star\" size=\"24\" color=\"#007aff\"></uni-icons>\n        </view>\n        <view class=\"menu-content\">\n          <text class=\"menu-title\">我的社团</text>\n          <text class=\"menu-subtitle\">已加入的社团</text>\n        </view>\n        <uni-icons type=\"arrowright\" size=\"16\" color=\"#ccc\"></uni-icons>\n      </view>\n\n      <!-- 我的活动 -->\n      <view class=\"menu-item\" @tap=\"goToMyActivities\">\n        <view class=\"menu-icon\">\n          <uni-icons type=\"calendar\" size=\"24\" color=\"#52c41a\"></uni-icons>\n        </view>\n        <view class=\"menu-content\">\n          <text class=\"menu-title\">我的活动</text>\n          <text class=\"menu-subtitle\">已报名的活动</text>\n        </view>\n        <uni-icons type=\"arrowright\" size=\"16\" color=\"#ccc\"></uni-icons>\n      </view>\n\n      <!-- 入社申请 -->\n      <view class=\"menu-item\" @tap=\"goToMyApplications\">\n        <view class=\"menu-icon\">\n          <uni-icons type=\"paperclip\" size=\"24\" color=\"#fa8c16\"></uni-icons>\n        </view>\n        <view class=\"menu-content\">\n          <text class=\"menu-title\">入社申请</text>\n          <text class=\"menu-subtitle\">我的申请记录</text>\n        </view>\n        <uni-icons type=\"arrowright\" size=\"16\" color=\"#ccc\"></uni-icons>\n      </view>\n\n      <!-- 我的消息 -->\n      <view class=\"menu-item\" @tap=\"goToMyMessages\">\n        <view class=\"menu-icon\">\n          <uni-icons type=\"chatbubble\" size=\"24\" color=\"#eb2f96\"></uni-icons>\n        </view>\n        <view class=\"menu-content\">\n          <text class=\"menu-title\">我的消息</text>\n          <text class=\"menu-subtitle\">系统通知和社团消息</text>\n        </view>\n        <view class=\"message-badge\" v-if=\"unreadCount > 0\">\n          {{ unreadCount > 99 ? '99+' : unreadCount }}\n        </view>\n        <uni-icons type=\"arrowright\" size=\"16\" color=\"#ccc\"></uni-icons>\n      </view>\n    </view>\n\n    <!-- 设置区域 -->\n    <view class=\"menu-section\">\n      <!-- 修改密码 -->\n      <view class=\"menu-item\" @tap=\"goToChangePassword\">\n        <view class=\"menu-icon\">\n          <uni-icons type=\"locked\" size=\"24\" color=\"#666\"></uni-icons>\n        </view>\n        <view class=\"menu-content\">\n          <text class=\"menu-title\">修改密码</text>\n          <text class=\"menu-subtitle\">安全设置</text>\n        </view>\n        <uni-icons type=\"arrowright\" size=\"16\" color=\"#ccc\"></uni-icons>\n      </view>\n\n      <!-- 关于我们 -->\n      <view class=\"menu-item\" @tap=\"goToAbout\">\n        <view class=\"menu-icon\">\n          <uni-icons type=\"info\" size=\"24\" color=\"#666\"></uni-icons>\n        </view>\n        <view class=\"menu-content\">\n          <text class=\"menu-title\">关于我们</text>\n          <text class=\"menu-subtitle\">版本信息</text>\n        </view>\n        <uni-icons type=\"arrowright\" size=\"16\" color=\"#ccc\"></uni-icons>\n      </view>\n\n      <!-- 退出登录 -->\n      <view class=\"menu-item logout\" @tap=\"logout\">\n        <view class=\"menu-icon\">\n          <uni-icons type=\"logout\" size=\"24\" color=\"#ff4d4f\"></uni-icons>\n        </view>\n        <view class=\"menu-content\">\n          <text class=\"menu-title\">退出登录</text>\n        </view>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script>\nimport { personalApi } from '../../../api/student/personal.js';\nimport lazyImage from '../../../components/lazy-image/lazy-image.vue';\nimport skeleton from '../../../components/skeleton/skeleton.vue';\n\nexport default {\n  components: {\n    lazyImage,\n    skeleton\n  },\n  data() {\n    return {\n      userInfo: {},\n      unreadCount: 0,\n      isLoading: true\n    };\n  },\n  onLoad() {\n    // 页面加载\n  },\n  onShow() {\n    this.isLoading = true;\n    // 并行加载数据，提升性能\n    Promise.all([\n      this.loadUserInfo(),\n      this.loadUnreadCount()\n    ]).finally(() => {\n      this.isLoading = false;\n    });\n  },\n  methods: {\n    // 加载用户信息\n    async loadUserInfo() {\n      try {\n        const res = await personalApi.getPersonalInfo();\n        if (res.code === 200) {\n          this.userInfo = res.data;\n        }\n      } catch (error) {\n        console.error('加载用户信息失败:', error);\n        return Promise.reject(error);\n      }\n    },\n\n    // 加载未读消息数量\n    async loadUnreadCount() {\n      try {\n        // 从本地存储获取用户信息\n        const userInfo = uni.getStorageSync('userInfo');\n        if (!userInfo || !userInfo.userId) {\n          console.error('用户未登录或用户信息不完整');\n          return;\n        }\n        \n        const res = await personalApi.getUnreadCount(userInfo.userId);\n        if (res.code === 200) {\n          this.unreadCount = res.data || 0;\n        }\n      } catch (error) {\n        console.error('加载未读消息数量失败:', error);\n        return Promise.reject(error);\n      }\n    },\n\n    // 选择头像\n    chooseAvatar() {\n      uni.chooseImage({\n        count: 1,\n        sizeType: ['compressed'],\n        sourceType: ['album', 'camera'],\n        success: async (res) => {\n          const filePath = res.tempFilePaths[0];\n          this.uploadAvatar(filePath);\n        }\n      });\n    },\n\n    // 上传头像\n    async uploadAvatar(filePath) {\n      uni.showLoading({ title: '上传中' });\n      try {\n        const res = await personalApi.uploadAvatar(filePath);\n        if (res.code === 200) {\n          this.userInfo.avatar = res.data.url;\n          uni.showToast({ title: '头像上传成功', icon: 'success' });\n        } else {\n          uni.showToast({ title: res.message || '上传失败', icon: 'none' });\n        }\n      } catch (error) {\n        console.error('上传头像失败:', error);\n        uni.showToast({ title: '网络错误', icon: 'none' });\n      } finally {\n        uni.hideLoading();\n      }\n    },\n\n    // 编辑个人信息\n    editPersonalInfo() {\n      // 跳转到编辑个人信息页面\n      uni.navigateTo({\n        url: '/pages/student/personal/edit'\n      });\n    },\n\n    // 跳转到我的社团\n    goToMyClubs() {\n      uni.navigateTo({\n        url: '/pages/student/personal/my-clubs'\n      });\n    },\n\n    // 跳转到我的活动\n    goToMyActivities() {\n      uni.navigateTo({\n        url: '/pages/student/personal/my-activities'\n      });\n    },\n\n    // 跳转到我的申请\n    goToMyApplications() {\n      uni.navigateTo({\n        url: '/pages/student/personal/my-applications'\n      });\n    },\n\n    // 跳转到我的消息\n    goToMyMessages() {\n      uni.navigateTo({\n        url: '/pages/student/personal/messages'\n      });\n    },\n\n    // 跳转到修改密码\n    goToChangePassword() {\n      uni.navigateTo({\n        url: '/pages/student/personal/change-password'\n      });\n    },\n\n    // 跳转到关于我们\n    goToAbout() {\n      uni.navigateTo({\n        url: '/pages/student/personal/about'\n      });\n    },\n\n    // 退出登录\n    logout() {\n      uni.showModal({\n        title: '退出登录',\n        content: '确定要退出登录吗？',\n        success: async (res) => {\n          if (res.confirm) {\n            // 清除本地存储的登录信息\n            uni.removeStorageSync('token');\n            uni.removeStorageSync('userInfo');\n            // 跳转到登录页面\n            uni.reLaunch({\n              url: '/pages/student/auth/login'\n            });\n          }\n        }\n      });\n    }\n  }\n};\n</script>\n\n<style scoped>\n.personal-container {\n  min-height: 100vh;\n  background-color: #f5f5f5;\n}\n\n/* 用户信息区域 */\n.user-info-section {\n  display: flex;\n  align-items: center;\n  padding: 40rpx 20rpx;\n  background: linear-gradient(135deg, #007aff 0%, #0056b3 100%);\n}\n\n.user-avatar {\n  position: relative;\n  width: 120rpx;\n  height: 120rpx;\n  border-radius: 50%;\n  overflow: hidden;\n  border: 3rpx solid rgba(255, 255, 255, 0.5);\n}\n\n.user-avatar image {\n  width: 100%;\n  height: 100%;\n}\n\n.upload-icon {\n  position: absolute;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  height: 30rpx;\n  background-color: rgba(0, 0, 0, 0.5);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.user-info {\n  flex: 1;\n  margin-left: 20rpx;\n  color: #fff;\n}\n\n.user-name {\n  display: block;\n  font-size: 32rpx;\n  font-weight: bold;\n  margin-bottom: 5rpx;\n}\n\n.user-email {\n  display: block;\n  font-size: 24rpx;\n  opacity: 0.9;\n}\n\n/* 功能菜单区域 */\n.menu-section {\n  margin-top: 20rpx;\n  background-color: #fff;\n}\n\n.menu-item {\n  display: flex;\n  align-items: center;\n  padding: 25rpx 20rpx;\n  border-bottom: 1rpx solid #f0f0f0;\n}\n\n.menu-item:last-child {\n  border-bottom: none;\n}\n\n.menu-icon {\n  width: 50rpx;\n  height: 50rpx;\n  border-radius: 10rpx;\n  background-color: #f0f8ff;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.menu-content {\n  flex: 1;\n  margin-left: 20rpx;\n}\n\n.menu-title {\n  display: block;\n  font-size: 30rpx;\n  color: #333;\n  margin-bottom: 3rpx;\n}\n\n.menu-subtitle {\n  display: block;\n  font-size: 22rpx;\n  color: #999;\n}\n\n.message-badge {\n  position: absolute;\n  right: 20rpx;\n  background-color: #ff4d4f;\n  color: #fff;\n  font-size: 20rpx;\n  padding: 2rpx 8rpx;\n  border-radius: 10rpx;\n  min-width: 32rpx;\n  text-align: center;\n}\n\n.logout .menu-title {\n  color: #ff4d4f;\n}\n</style>\n","import MiniProgramPage from 'C:/Users/Fooler/Desktop/MultiCommunityApplication/sss/community-frontend-wxprogram/pages/student/personal/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["personalApi","uni"],"mappings":";;;AAmHA,MAAO,YAAW,MAAW;AAC7B,MAAK,WAAY,MAAW;AAE5B,MAAK,YAAU;AAAA,EACb,YAAY;AAAA,IACV;AAAA,IACA;AAAA,EACD;AAAA,EACD,OAAO;AACL,WAAO;AAAA,MACL,UAAU,CAAE;AAAA,MACZ,aAAa;AAAA,MACb,WAAW;AAAA;EAEd;AAAA,EACD,SAAS;AAAA,EAER;AAAA,EACD,SAAS;AACP,SAAK,YAAY;AAEjB,YAAQ,IAAI;AAAA,MACV,KAAK,aAAc;AAAA,MACnB,KAAK,gBAAgB;AAAA,IACvB,CAAC,EAAE,QAAQ,MAAM;AACf,WAAK,YAAY;AAAA,IACnB,CAAC;AAAA,EACF;AAAA,EACD,SAAS;AAAA;AAAA,IAEP,MAAM,eAAe;AACnB,UAAI;AACF,cAAM,MAAM,MAAMA,iCAAY;AAC9B,YAAI,IAAI,SAAS,KAAK;AACpB,eAAK,WAAW,IAAI;AAAA,QACtB;AAAA,MACA,SAAO,OAAO;AACdC,sBAAc,MAAA,MAAA,SAAA,2CAAA,aAAa,KAAK;AAChC,eAAO,QAAQ,OAAO,KAAK;AAAA,MAC7B;AAAA,IACD;AAAA;AAAA,IAGD,MAAM,kBAAkB;AACtB,UAAI;AAEF,cAAM,WAAWA,cAAAA,MAAI,eAAe,UAAU;AAC9C,YAAI,CAAC,YAAY,CAAC,SAAS,QAAQ;AACjCA,wBAAAA,MAAc,MAAA,SAAA,2CAAA,eAAe;AAC7B;AAAA,QACF;AAEA,cAAM,MAAM,MAAMD,qBAAW,YAAC,eAAe,SAAS,MAAM;AAC5D,YAAI,IAAI,SAAS,KAAK;AACpB,eAAK,cAAc,IAAI,QAAQ;AAAA,QACjC;AAAA,MACA,SAAO,OAAO;AACdC,sBAAA,MAAA,MAAA,SAAA,2CAAc,eAAe,KAAK;AAClC,eAAO,QAAQ,OAAO,KAAK;AAAA,MAC7B;AAAA,IACD;AAAA;AAAA,IAGD,eAAe;AACbA,oBAAAA,MAAI,YAAY;AAAA,QACd,OAAO;AAAA,QACP,UAAU,CAAC,YAAY;AAAA,QACvB,YAAY,CAAC,SAAS,QAAQ;AAAA,QAC9B,SAAS,OAAO,QAAQ;AACtB,gBAAM,WAAW,IAAI,cAAc,CAAC;AACpC,eAAK,aAAa,QAAQ;AAAA,QAC5B;AAAA,MACF,CAAC;AAAA,IACF;AAAA;AAAA,IAGD,MAAM,aAAa,UAAU;AAC3BA,oBAAAA,MAAI,YAAY,EAAE,OAAO,MAAO,CAAA;AAChC,UAAI;AACF,cAAM,MAAM,MAAMD,qBAAAA,YAAY,aAAa,QAAQ;AACnD,YAAI,IAAI,SAAS,KAAK;AACpB,eAAK,SAAS,SAAS,IAAI,KAAK;AAChCC,wBAAG,MAAC,UAAU,EAAE,OAAO,UAAU,MAAM,UAAQ,CAAG;AAAA,eAC7C;AACLA,8BAAI,UAAU,EAAE,OAAO,IAAI,WAAW,QAAQ,MAAM,OAAO,CAAC;AAAA,QAC9D;AAAA,MACA,SAAO,OAAO;AACdA,sBAAA,MAAA,MAAA,SAAA,2CAAc,WAAW,KAAK;AAC9BA,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,OAAK,CAAG;AAAA,MAC/C,UAAU;AACRA,sBAAG,MAAC,YAAW;AAAA,MACjB;AAAA,IACD;AAAA;AAAA,IAGD,mBAAmB;AAEjBA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK;AAAA,MACP,CAAC;AAAA,IACF;AAAA;AAAA,IAGD,cAAc;AACZA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK;AAAA,MACP,CAAC;AAAA,IACF;AAAA;AAAA,IAGD,mBAAmB;AACjBA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK;AAAA,MACP,CAAC;AAAA,IACF;AAAA;AAAA,IAGD,qBAAqB;AACnBA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK;AAAA,MACP,CAAC;AAAA,IACF;AAAA;AAAA,IAGD,iBAAiB;AACfA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK;AAAA,MACP,CAAC;AAAA,IACF;AAAA;AAAA,IAGD,qBAAqB;AACnBA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK;AAAA,MACP,CAAC;AAAA,IACF;AAAA;AAAA,IAGD,YAAY;AACVA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK;AAAA,MACP,CAAC;AAAA,IACF;AAAA;AAAA,IAGD,SAAS;AACPA,oBAAAA,MAAI,UAAU;AAAA,QACZ,OAAO;AAAA,QACP,SAAS;AAAA,QACT,SAAS,OAAO,QAAQ;AACtB,cAAI,IAAI,SAAS;AAEfA,gCAAI,kBAAkB,OAAO;AAC7BA,gCAAI,kBAAkB,UAAU;AAEhCA,0BAAAA,MAAI,SAAS;AAAA,cACX,KAAK;AAAA,YACP,CAAC;AAAA,UACH;AAAA,QACF;AAAA,MACF,CAAC;AAAA,IACH;AAAA,EACF;AACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACrRA,GAAG,WAAW,eAAe;"}