{"version":3,"file":"detail.js","sources":["pages/student/activity/detail.vue","../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc3R1ZGVudC9hY3Rpdml0eS9kZXRhaWwudnVl"],"sourcesContent":["<template>\n  <view class=\"activity-detail-container\">\n    <!-- 活动封面 -->\n    <view class=\"activity-cover\">\n      <lazy-image :src=\"activityDetail.cover || '/static/student/default-activity.png'\" mode=\"aspectFill\"></lazy-image>\n      <view class=\"activity-status\" v-if=\"activityDetail.status\">\n        {{ getStatusText(activityDetail.status) }}\n      </view>\n    </view>\n\n    <!-- 活动基本信息 -->\n    <view class=\"activity-info\">\n      <text class=\"activity-title\">{{ activityDetail.title }}</text>\n      <view class=\"activity-meta\">\n        <view class=\"meta-item\">\n          <uni-icons type=\"time\" size=\"16\" color=\"#999\"></uni-icons>\n          <text>{{ formatDate(activityDetail.startTime) }}</text>\n          <text v-if=\"activityDetail.endTime\"> - {{ formatDate(activityDetail.endTime, true) }}</text>\n        </view>\n        <view class=\"meta-item\">\n          <uni-icons type=\"location\" size=\"16\" color=\"#999\"></uni-icons>\n          <text>{{ activityDetail.location || '地点待定' }}</text>\n        </view>\n      </view>\n      <view class=\"activity-stats\">\n        <view class=\"stat-item\">\n          <uni-icons type=\"person\" size=\"16\" color=\"#999\"></uni-icons>\n          <text>{{ activityDetail.joinCount || 0 }}人已报名</text>\n        </view>\n        <view class=\"stat-item\" v-if=\"activityDetail.maxParticipants\">\n          <text>/ {{ activityDetail.maxParticipants }}人</text>\n        </view>\n      </view>\n    </view>\n\n    <!-- 举办社团 -->\n    <view class=\"section\">\n      <view class=\"section-title\">举办社团</view>\n      <view class=\"section-content\">\n        <view class=\"club-info\" @tap=\"goToClubDetail(activityDetail.clubId)\">\n          <lazy-image :src=\"activityDetail.clubLogo || '/static/student/default-club.png'\" mode=\"aspectFill\"></lazy-image>\n          <text class=\"club-name\">{{ activityDetail.clubName }}</text>\n          <uni-icons type=\"arrowright\" size=\"16\" color=\"#ccc\"></uni-icons>\n        </view>\n      </view>\n    </view>\n\n    <!-- 活动详情 -->\n    <view class=\"section\">\n      <view class=\"section-title\">活动详情</view>\n      <view class=\"section-content\">\n        <text>{{ activityDetail.description || '该活动暂无详情' }}</text>\n      </view>\n    </view>\n\n    <!-- 底部操作栏 -->\n    <view class=\"bottom-bar\">\n      <button \n        v-if=\"!isJoined && canSignUp\" \n        class=\"sign-up-btn\" \n        @click=\"signUpActivity\"\n      >\n        立即报名\n      </button>\n      <button \n        v-else-if=\"isJoined\" \n        class=\"cancel-btn\" \n        @click=\"cancelSignUp\"\n      >\n        取消报名\n      </button>\n      <button \n        v-else \n        class=\"disabled-btn\" \n        disabled\n      >\n        {{ getButtonText() }}\n      </button>\n    </view>\n  </view>\n</template>\n\n<script>\nimport { activityApi } from '../../../api/student/activity.js';\nimport lazyImage from '../../../components/lazy-image/lazy-image.vue';\n\nexport default {\n  components: {\n    lazyImage\n  },\n  data() {\n    return {\n      activityId: '',\n      activityDetail: {},\n      isJoined: false, // 是否已报名\n      canSignUp: true // 是否可以报名\n    };\n  },\n  onLoad(options) {\n    this.activityId = options.id;\n    this.loadActivityDetail();\n  },\n  methods: {\n    // 加载活动详情\n    async loadActivityDetail() {\n      uni.showLoading({ title: '加载中' });\n      try {\n        const res = await activityApi.getActivityDetail(this.activityId);\n        if (res.code === 200) {\n          this.activityDetail = res.data;\n          this.isJoined = res.data.isJoined || false;\n          this.canSignUp = this.checkCanSignUp();\n        } else {\n          uni.showToast({ title: res.message || '加载失败', icon: 'none' });\n        }\n      } catch (error) {\n        console.error('加载活动详情失败:', error);\n        uni.showToast({ title: '网络错误', icon: 'none' });\n      } finally {\n        uni.hideLoading();\n      }\n    },\n    \n    // 检查是否可以报名\n    checkCanSignUp() {\n      const now = new Date();\n      const startTime = new Date(this.activityDetail.startTime);\n      const endTime = this.activityDetail.endTime ? new Date(this.activityDetail.endTime) : null;\n      const maxParticipants = this.activityDetail.maxParticipants;\n      const joinCount = this.activityDetail.joinCount || 0;\n      \n      // 检查是否已过开始时间、是否已达人数上限\n      if (now > startTime) return false;\n      if (maxParticipants && joinCount >= maxParticipants) return false;\n      if (this.activityDetail.status === 'closed') return false;\n      \n      return true;\n    },\n    \n    // 报名活动\n    async signUpActivity() {\n      try {\n        const res = await activityApi.signUpActivity(this.activityId);\n        if (res.code === 200) {\n          uni.showToast({ title: '报名成功', icon: 'success' });\n          this.isJoined = true;\n          this.activityDetail.joinCount = (this.activityDetail.joinCount || 0) + 1;\n        } else {\n          uni.showToast({ title: res.message || '报名失败', icon: 'none' });\n        }\n      } catch (error) {\n        console.error('报名活动失败:', error);\n        uni.showToast({ title: '网络错误', icon: 'none' });\n      }\n    },\n    \n    // 取消报名\n    async cancelSignUp() {\n      try {\n        const res = await activityApi.cancelSignUpActivity(this.activityId);\n        if (res.code === 200) {\n          uni.showToast({ title: '已取消报名', icon: 'success' });\n          this.isJoined = false;\n          this.activityDetail.joinCount = Math.max(0, (this.activityDetail.joinCount || 0) - 1);\n        } else {\n          uni.showToast({ title: res.message || '取消失败', icon: 'none' });\n        }\n      } catch (error) {\n        console.error('取消报名失败:', error);\n        uni.showToast({ title: '网络错误', icon: 'none' });\n      }\n    },\n    \n    // 跳转到社团详情\n    goToClubDetail(clubId) {\n      if (clubId) {\n        uni.navigateTo({\n          url: `/pages/student/club/detail?id=${clubId}`\n        });\n      }\n    },\n    // 格式化日期\n    formatDate(dateStr, timeOnly = false) {\n      if (!dateStr) return '';\n      const date = new Date(dateStr);\n      if (timeOnly) {\n        return `${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;\n      }\n      return `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')} ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;\n    },\n    \n    // 获取状态文本\n    getStatusText(status) {\n      const statusMap = {\n        'upcoming': '即将开始',\n        'ongoing': '进行中',\n        'ended': '已结束',\n        'closed': '已关闭'\n      };\n      return statusMap[status] || status;\n    },\n    \n    // 获取按钮文本\n    getButtonText() {\n      if (this.activityDetail.status === 'ended' || this.activityDetail.status === 'closed') {\n        return '活动已结束';\n      }\n      const now = new Date();\n      const startTime = new Date(this.activityDetail.startTime);\n      if (now > startTime) {\n        return '活动已开始';\n      }\n      if (this.activityDetail.maxParticipants && (this.activityDetail.joinCount >= this.activityDetail.maxParticipants)) {\n        return '名额已满';\n      }\n      return '不可报名';\n    }\n  }\n};\n</script>\n\n<style scoped>\n.activity-detail-container {\n  min-height: 100vh;\n  background-color: #f5f5f5;\n}\n\n/* 活动封面 */\n.activity-cover {\n  position: relative;\n  height: 400rpx;\n  overflow: hidden;\n}\n\n.activity-cover image {\n  width: 100%;\n  height: 100%;\n}\n\n.activity-status {\n  position: absolute;\n  top: 20rpx;\n  right: 20rpx;\n  padding: 8rpx 16rpx;\n  font-size: 24rpx;\n  color: #fff;\n  background-color: rgba(0, 0, 0, 0.5);\n  border-radius: 20rpx;\n}\n\n/* 活动基本信息 */\n.activity-info {\n  padding: 20rpx;\n  background-color: #fff;\n}\n\n.activity-title {\n  display: block;\n  font-size: 34rpx;\n  font-weight: bold;\n  color: #333;\n  line-height: 48rpx;\n}\n\n.activity-meta {\n  margin-top: 15rpx;\n}\n\n.meta-item {\n  display: flex;\n  align-items: center;\n  margin-bottom: 10rpx;\n  font-size: 26rpx;\n  color: #666;\n}\n\n.meta-item text {\n  margin-left: 5rpx;\n}\n\n.activity-stats {\n  display: flex;\n  align-items: center;\n  margin-top: 15rpx;\n  font-size: 24rpx;\n  color: #999;\n}\n\n.stat-item {\n  display: flex;\n  align-items: center;\n}\n\n/* 通用区块样式 */\n.section {\n  margin-top: 20rpx;\n  padding: 0 20rpx;\n  background-color: #fff;\n}\n\n.section-title {\n  padding: 20rpx 0;\n  font-size: 30rpx;\n  font-weight: bold;\n  color: #333;\n  border-bottom: 1rpx solid #eee;\n}\n\n.section-content {\n  padding: 20rpx 0;\n}\n\n.section-content text {\n  font-size: 28rpx;\n  color: #666;\n  line-height: 40rpx;\n}\n\n/* 举办社团 */\n.club-info {\n  display: flex;\n  align-items: center;\n}\n\n.club-info image {\n  width: 60rpx;\n  height: 60rpx;\n  border-radius: 10rpx;\n}\n\n.club-name {\n  flex: 1;\n  margin-left: 15rpx;\n  font-size: 28rpx;\n  color: #333;\n}\n\n/* 底部操作栏 */\n.bottom-bar {\n  position: fixed;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  padding: 20rpx;\n  background-color: #fff;\n  border-top: 1rpx solid #eee;\n  display: flex;\n  justify-content: center;\n}\n\n.sign-up-btn {\n  width: 100%;\n  height: 80rpx;\n  font-size: 30rpx;\n  color: #fff;\n  background-color: #007aff;\n  border-radius: 40rpx;\n}\n\n.cancel-btn {\n  width: 100%;\n  height: 80rpx;\n  font-size: 30rpx;\n  color: #666;\n  background-color: #f5f5f5;\n  border-radius: 40rpx;\n}\n\n.disabled-btn {\n  width: 100%;\n  height: 80rpx;\n  font-size: 30rpx;\n  color: #999;\n  background-color: #eee;\n  border-radius: 40rpx;\n}\n</style>\n","import MiniProgramPage from 'C:/Users/Fooler/Desktop/MultiCommunityApplication/sss/community-frontend-wxprogram/pages/student/activity/detail.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","activityApi"],"mappings":"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"}